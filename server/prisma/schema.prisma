generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Módulos del sistema (agregables bajo demanda)
model Modulo {
  id          Int          @id @default(autoincrement())
  nombre      String       @unique
  descripcion String?
  icono       String?      // Icono para el menú
  orden       Int          @default(0)
  activo      Boolean      @default(true)
  permisos    Permiso[]
  roles       RolModulo[]
  createdAt   DateTime     @default(now())
}

// Roles del sistema (admin, viewer, o personalizados)
model Rol {
  id          Int          @id @default(autoincrement())
  nombre      String       @unique
  descripcion String?
  esBase      Boolean      @default(false) // true para admin y viewer
  roles       RolModulo[]  // Relación muchos a muchos con módulos
  usuarios    UsuarioRol[]
  createdAt   DateTime     @default(now())
}

// Relación muchos a muchos Rol-Modulo (qué módulos tiene cada rol)
model RolModulo {
  rolId    Int
  moduloId Int
  rol      Rol    @relation(fields: [rolId], references: [id], onDelete: Cascade)
  modulo   Modulo @relation(fields: [moduloId], references: [id], onDelete: Cascade)

  @@id([rolId, moduloId])
}

// Permisos por módulo (ver, crear, editar, eliminar, exportar)
model Permiso {
  id       Int     @id @default(autoincrement())
  moduloId Int
  accion   String  // ver, crear, editar, eliminar, exportar
  modulo   Modulo  @relation(fields: [moduloId], references: [id], onDelete: Cascade)

  @@unique([moduloId, accion])
}

// Relación muchos a muchos usuarios-roles
model UsuarioRol {
  usuarioId Int
  rolId     Int
  usuario   User @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  rol       Rol  @relation(fields: [rolId], references: [id], onDelete: Cascade)

  @@id([usuarioId, rolId])
}

model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique
  password     String
  nombre       String
  rol          String        @default("user") // rol legacy para compatibilidad
  activo       Boolean       @default(true)
  usuarioRoles UsuarioRol[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Servidor {
  id               Int     @id @default(autoincrement())
  pais             String
  host             String
  nombreVM         String?
  ip               String?
  cpu              Int?
  memoria          String?
  disco            String?
  ambiente         String
  arquitectura     String?
  sistemaOperativo String?
  version          String?
  antivirus        String?
  estado           String
  responsable      String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model InventarioFisico {
  id             Int      @id @default(autoincrement())
  pais           String
  categoria      String
  marca          String
  modelo         String?
  serie          String?
  inventario     String?
  estado         String
  responsable    String?
  observaciones  String?
  equipo         String?
  direccionIp    String?
  ilo            String?
  descripcion    String?
  serial         String?
  sistemaOperativo String?
  garantia       String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model InventarioCloud {
  id               Int     @id @default(autoincrement())
  tenant           String?
  nube             String?
  instanceName     String?
  ipPublica        String?
  ipPrivada        String?
  instanceType     String?
  cpu              Int?
  ram              String?
  storageGib       String?
  sistemaOperativo String?
  costoUsd         String?
  hostName         String?
  responsable      String?
  modoUso          String?
  service          String?
  antivirus        String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Configuracion {
  id        Int      @id @default(autoincrement())
  clave     String   @unique
  valor     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EmailConfig {
  id          Int      @id @default(autoincrement())
  host        String
  puerto      Int      @default(587)
  usuario     String
  contrasena  String
  usandoTls   Boolean  @default(true)
  emailFrom   String
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
